<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediaBox AI Dashboard</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;500;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #0a1929, #1a237e, #0d47a1, #1565c0);
      background-size: 100% 100%;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #fff;
      padding: 20px;
      overflow-x: hidden;
      position: relative;
    }

    /* Background Theme Variations */
    body.theme-blue {
      background: linear-gradient(135deg, #0a1929, #1a237e, #0d47a1, #1565c0);
    }

    body.theme-black {
      background: linear-gradient(135deg, #000000, #1a1a1a, #0a0a0a, #2d2d2d);
    }

    body.theme-grey {
      background: linear-gradient(135deg, #1c1c1c, #2d2d2d, #3a3a3a, #505050);
    }

    body.theme-purple {
      background: linear-gradient(135deg, #1a0033, #2d1b69, #5a189a, #7209b7);
    }

    body.theme-teal {
      background: linear-gradient(135deg, #003d3d, #006666, #008b8b, #20b2aa);
    }


    /* Static Wave Shapes */
    body::before,
    body::after {
      content: '';
      position: fixed;
      filter: blur(100px);
      opacity: 0.2;
      z-index: 0;
    }

    body::before {
      width: 1200px;
      height: 600px;
      background: linear-gradient(90deg, #1e88e5 0%, #42a5f5 50%, #64b5f6 100%);
      top: -200px;
      left: -400px;
      border-radius: 40%;
    }

    body::after {
      width: 1400px;
      height: 700px;
      background: linear-gradient(90deg, #0d47a1 0%, #1565c0 50%, #1976d2 100%);
      bottom: -250px;
      right: -500px;
      border-radius: 45%;
    }


    .shape {
      position: fixed;
      filter: blur(80px);
      opacity: 0.15;
      z-index: 0;
    }

    .shape1 {
      width: 600px;
      height: 400px;
      background: linear-gradient(120deg, #29b6f6 0%, #0277bd 100%);
      top: 15%;
      right: 5%;
      border-radius: 50% 40% 60% 50%;
    }

    .shape2 {
      width: 700px;
      height: 500px;
      background: linear-gradient(45deg, #039be5 0%, #01579b 100%);
      bottom: 5%;
      left: -100px;
      border-radius: 60% 50% 40% 60%;
    }

    .shape3 {
      width: 500px;
      height: 500px;
      background: linear-gradient(90deg, #4fc3f7 0%, #0288d1 50%, #01579b 100%);
      top: 45%;
      left: 40%;
      border-radius: 40% 60% 50% 40%;
    }

    .container {
      width: 100%;
      max-width: 1920px;
      position: relative;
      z-index: 1;
    }

    .glass-panel {
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 30px;
      text-align: center;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .logo-title {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .logo {
      height: 60px;
      width: auto;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
      transition: transform 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    h1 {
      font-weight: 700;
      font-size: 2.2em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      margin: 0;
      background: linear-gradient(135deg, #ffffff 0%, #a8daff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }

    .mode-toggle {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      padding: 8px 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.8em;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .mode-toggle:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 13px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .toggle-switch.active {
      background: rgba(100, 255, 100, 0.3);
    }

    .toggle-slider {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s ease;
    }

    .toggle-switch.active .toggle-slider {
      transform: translateX(24px);
    }

    .status-message {
      padding: 12px 20px;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.2);
      font-size: 0.9em;
      min-width: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .main-content {
      display: grid;
      grid-template-columns: 1fr;
      gap: 25px;
    }

    .services-section {
      display: flex;
      flex-direction: column;
      gap: 20px;
      background: rgba(0, 0, 0, 0.5);
      padding: 25px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .section-title {
      font-size: 1.1em;
      font-weight: 500;
      text-align: left;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    .button-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
    }

    .dashboard-button {
      background: rgba(255, 255, 255, 0.15);
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 15px;
      padding: 25px 15px;
      font-size: 1.1em;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      font-family: 'Roboto', sans-serif;
      position: relative;
      overflow: hidden;
    }

    .dashboard-button:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    .dashboard-button:active {
      transform: translateY(-1px);
    }

    .dashboard-button.clicked {
      border-color: #ffd700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.6), 0 0 40px rgba(255, 215, 0, 0.4);
      animation: pulseGold 2s ease-in-out;
    }

    @keyframes pulseGold {
      0%, 100% {
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.6), 0 0 40px rgba(255, 215, 0, 0.4);
      }
      50% {
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 215, 0, 0.6);
      }
    }

    .button-icon {
      font-size: 2.2em;
    }

    .service-logo {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-bottom: 5px;
    }

    .button-label {
      font-size: 0.85em;
      font-weight: 500;
    }

    .controls-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .volume-lighting-section, .system-section {
      background: rgba(0, 0, 0, 0.5);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .collapsible-header {
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
    }

    .collapse-icon {
      font-size: 1.2em;
      transition: transform 0.3s ease;
    }

    .collapse-icon.expanded {
      transform: rotate(180deg);
    }

    .collapsible-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .collapsible-content.expanded {
      max-height: 500px;
    }

    .mode-controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 15px;
    }

    .mode-controls .mode-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .mode-controls .mode-toggle:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .mode-controls .mode-toggle span {
      font-size: 0.9em;
      font-weight: 500;
    }

    .audio-section {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 15px;
    }

    .audio-output-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .audio-btn {
      background: rgba(100, 100, 255, 0.2);
      border: 1px solid rgba(100, 100, 255, 0.4);
      border-radius: 10px;
      padding: 12px 20px;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Roboto', sans-serif;
      font-size: 0.95em;
    }

    .audio-btn:hover {
      background: rgba(100, 100, 255, 0.4);
      transform: scale(1.05);
    }

    .audio-btn.active {
      background: rgba(100, 255, 100, 0.3);
      border-color: rgba(100, 255, 100, 0.6);
    }

    .volume-control {
      display: flex;
      align-items: center;
      gap: 12px;
      justify-content: center;
    }

    .volume-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(100, 100, 255, 0.3);
      border: 2px solid rgba(100, 100, 255, 0.6);
      color: #fff;
      font-size: 1.2em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .volume-btn:hover {
      background: rgba(100, 100, 255, 0.5);
      transform: scale(1.1);
    }

    .volume-btn:active {
      transform: scale(0.95);
    }

    .volume-icon {
      font-size: 1.2em;
    }

    .volume-slider {
      flex: 1;
      max-width: 300px;
      height: 12px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
      cursor: pointer;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(79, 172, 254, 0.3);
      border: 2px solid #fff;
    }

    .volume-slider::-moz-range-thumb {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      cursor: pointer;
      border: 2px solid #fff;
      box-shadow: 0 4px 8px rgba(79, 172, 254, 0.3);
    }

    .system-controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 15px;
    }

    .system-btn {
      background: rgba(255, 100, 100, 0.2);
      border: 1px solid rgba(255, 100, 100, 0.4);
      border-radius: 10px;
      padding: 14px 20px;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Roboto', sans-serif;
      font-size: 0.95em;
      width: 100%;
    }

    .system-btn:hover {
      background: rgba(255, 100, 100, 0.4);
      transform: translateX(3px);
    }

    .info-bar {
      margin-top: 25px;
      padding: 20px 25px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .info-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .info-icon {
      font-size: 2em;
    }

    .info-main {
      font-size: 1.3em;
      font-weight: 500;
    }

    .info-sub {
      font-size: 0.85em;
      opacity: 0.7;
    }

    .lighting-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 15px;
    }

    .light-btn {
      background: rgba(255, 200, 100, 0.2);
      border: 1px solid rgba(255, 200, 100, 0.4);
      border-radius: 10px;
      padding: 12px 20px;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Roboto', sans-serif;
      font-size: 0.95em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .light-btn:hover {
      background: rgba(255, 200, 100, 0.4);
      transform: scale(1.05);
    }

    .light-btn:active {
      transform: scale(0.98);
    }

    .news-ticker {
      margin-top: 25px;
      padding: 15px 25px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
      position: relative;
    }

    .news-content {
      display: flex;
      animation: scroll 60s linear infinite;
      white-space: nowrap;
    }

    .news-item {
      margin-right: 100px;
      font-size: 1.2em;
      opacity: 0.9;
      flex-shrink: 0;
      font-weight: 500;
    }

    @keyframes scroll {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }

    .build-info {
      margin-top: 15px;
      padding: 15px 20px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .build-number {
      font-size: 1.5em;
      font-weight: 700;
      color: #4facfe;
      text-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
    }

    .build-label {
      font-size: 0.9em;
      opacity: 0.7;
    }

    .help-button {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 2em;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .help-button:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 30px rgba(102, 126, 234, 0.6);
    }

    .help-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      z-index: 2000;
      overflow-y: auto;
    }

    .help-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .help-content {
      background: rgba(30, 30, 47, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 40px;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .help-close {
      position: absolute;
      top: 20px;
      right: 25px;
      font-size: 2em;
      color: white;
      cursor: pointer;
      background: none;
      border: none;
      opacity: 0.7;
      transition: opacity 0.3s;
    }

    .help-close:hover {
      opacity: 1;
    }

    .help-title {
      font-size: 2.5em;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .help-subtitle {
      font-size: 1.2em;
      opacity: 0.7;
      margin-bottom: 30px;
    }

    .feature-section {
      margin-bottom: 30px;
    }

    .feature-section h3 {
      font-size: 1.4em;
      margin-bottom: 15px;
      color: #4facfe;
    }

    .feature-list {
      list-style: none;
      padding: 0;
    }

    .feature-list li {
      padding: 12px 0;
      padding-left: 30px;
      position: relative;
      line-height: 1.6;
    }

    .feature-list li:before {
      content: "‚úì";
      position: absolute;
      left: 0;
      color: #4facfe;
      font-weight: bold;
      font-size: 1.2em;
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .feature-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .feature-card h4 {
      font-size: 1.1em;
      margin-bottom: 10px;
      color: #4facfe;
    }

    .feature-card p {
      font-size: 0.9em;
      opacity: 0.8;
      line-height: 1.5;
    }

    footer {
      margin-top: 15px;
      font-size: 0.7em;
      opacity: 0.4;
    }

    /* HD Widescreen 16:9 optimization */
    @media (min-width: 1280px) and (min-aspect-ratio: 16/9) {
      .glass-panel {
        padding: 25px 40px;
      }

      h1 {
        font-size: 2em;
      }

      .button-grid {
        grid-template-columns: repeat(6, 1fr);
      }

      .main-content {
        grid-template-columns: 2fr 1fr;
        gap: 30px;
      }

      .services-section {
        gap: 15px;
      }

      .controls-row {
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
    }

    /* Ultra-wide Cinema 2.35:1 optimization */
    @media (min-width: 2000px) and (min-aspect-ratio: 21/9) {
      body {
        padding: 15px 40px;
      }

      .container {
        max-width: 2560px;
      }

      .glass-panel {
        padding: 20px 50px;
      }

      h1 {
        font-size: 1.8em;
      }

      .header {
        margin-bottom: 20px;
      }

      .main-content {
        grid-template-columns: 3fr 1fr;
        gap: 40px;
      }
      
      .button-grid {
        grid-template-columns: repeat(6, 1fr);
        gap: 12px;
      }

      .dashboard-button {
        padding: 20px 12px;
        font-size: 1em;
      }

      .button-icon {
        font-size: 2em;
      }

      .button-label {
        font-size: 0.8em;
      }

      .controls-row {
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .section-title {
        font-size: 1em;
        margin-bottom: 8px;
      }

      .volume-lighting-section, .system-section {
        padding: 15px;
      }

      .audio-btn {
        padding: 10px 16px;
        font-size: 0.85em;
      }

      .system-btn {
        padding: 12px 16px;
        font-size: 0.85em;
      }

      footer {
        margin-top: 15px;
        font-size: 0.75em;
      }
    }

    /* Mobile and small screens */
    @media (max-width: 768px) {
      .logo {
        height: 45px;
      }

      h1 {
        font-size: 1.6em;
      }
      
      .header {
        flex-direction: column;
        align-items: stretch;
      }

      .logo-title {
        justify-content: center;
      }

      .status-message {
        min-width: auto;
      }

      .main-content {
        gap: 20px;
      }

      .button-grid {
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
      }

      .dashboard-button {
        padding: 20px 12px;
      }

      .controls-row {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .volume-slider {
        max-width: 200px;
      }
    }
  </style>
</head>
<body>
  <!-- Animated Background Shapes -->
  <div class="shape shape1"></div>
  <div class="shape shape2"></div>
  <div class="shape shape3"></div>

  <!-- Help Button -->
  <button class="help-button" onclick="toggleHelp()" title="Help & Features">
    ‚ùì
  </button>

  <!-- Help Modal -->
  <div class="help-modal" id="helpModal" onclick="closeHelpOnBackground(event)">
    <div class="help-content">
      <button class="help-close" onclick="toggleHelp()">√ó</button>
      
      <h2 class="help-title">üì∫ MediaBox AI Features</h2>
      <p class="help-subtitle">Your Complete Home Entertainment Hub</p>

      <div class="feature-section">
        <h3>üé¨ Streaming & Services</h3>
        <ul class="feature-list">
          <li><strong>Browser & Container Modes:</strong> Toggle between opening services in your Windows browser or launching in Docker container</li>
          <li><strong>Netflix, Prime Video, Plex:</strong> One-click access to all your favorite streaming platforms</li>
          <li><strong>Plexamp & Spotify:</strong> Music streaming with Plexamp for your library and Spotify Web</li>
          <li><strong>YouTube & Live TV:</strong> Watch videos and live TV channels instantly</li>
          <li><strong>Remote Plex Server:</strong> Connected to netlite.community for your media library</li>
          <li><strong>News:</strong> BBC News with clean, TV-friendly layout</li>
          <li><strong>Telegram:</strong> Web-based Telegram messaging client</li>
          <li><strong>Calendar:</strong> Outlook Bookings calendar for appointments and scheduling</li>
        </ul>
      </div>

      <div class="feature-section">
        <h3>üîä Audio Control</h3>
        <ul class="feature-list">
          <li><strong>Multiple Outputs:</strong> Switch between HDMI, SPDIF (Optical/Coax), and Analog (3.5mm)</li>
          <li><strong>Volume Control:</strong> Adjust volume with smooth slider interface</li>
          <li><strong>Hot-Swapping:</strong> Change audio outputs on-the-fly without interrupting playback</li>
        </ul>
      </div>

      <div class="feature-section">
        <h3>üí° Smart Home Integration</h3>
        <ul class="feature-list">
          <li><strong>Home Assistant:</strong> Full smart home control at port 8123</li>
          <li><strong>Light Control:</strong> Adjust room lighting brightness with smooth slider interface</li>
          <li><strong>Automation Ready:</strong> IR remote and KDE Connect compatible</li>
        </ul>
      </div>

      <div class="feature-section">
        <h3>üìä Live Information</h3>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>üïê Real-Time Clock</h4>
            <p>Current time and date updated every second</p>
          </div>
          <div class="feature-card">
            <h4>üå§Ô∏è Weather</h4>
            <p>Live temperature and conditions, updates every 10 minutes</p>
          </div>
          <div class="feature-card">
            <h4>üåê Network Info</h4>
            <p>Public IP address and connection status</p>
          </div>
          <div class="feature-card">
            <h4>üíæ System Status</h4>
            <p>Monitor system load and health</p>
          </div>
        </div>
      </div>

      <div class="feature-section">
        <h3>‚öôÔ∏è System Features</h3>
        <ul class="feature-list">
          <li><strong>Widescreen Optimized:</strong> Adapts to 16:9 HD and 2.35:1 cinema displays</li>
          <li><strong>Flask Auto-Reload:</strong> Code changes apply automatically without Docker restart</li>
          <li><strong>Responsive Design:</strong> Works on desktop, tablet, and mobile</li>
          <li><strong>Version Tracking:</strong> Build numbers track every change</li>
          <li><strong>Docker Powered:</strong> Isolated, reproducible environment</li>
          <li><strong>Network Accessible:</strong> Access from any device on your LAN</li>
        </ul>
      </div>

      <div class="feature-section">
        <h3>üéÆ Control Methods</h3>
        <ul class="feature-list">
          <li><strong>Web Interface:</strong> Full control via browser dashboard</li>
          <li><strong>IR Remote:</strong> Traditional remote control support</li>
          <li><strong>KDE Connect:</strong> Control from your phone</li>
          <li><strong>API Access:</strong> RESTful API for custom integrations</li>
        </ul>
      </div>

      <div class="feature-section" style="background: rgba(102, 126, 234, 0.1); padding: 20px; border-radius: 10px;">
        <h3>üí° Quick Tips</h3>
        <ul class="feature-list">
          <li>Use the mode toggle (top-right) to switch between Browser and Container modes</li>
          <li>All links automatically adapt to your network IP address</li>
          <li>Weather and network info update automatically in the background</li>
          <li>Press ESC key to close this help dialog</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="glass-panel">
      <!-- Header with Title and Status -->
      <div class="header">
        <div class="logo-title">
          <img src="logo.png" alt="MediaBox AI" class="logo" onerror="this.style.display='none'">
          <h1>MediaBox AI</h1>
        </div>
        <div class="header-right">
          <div class="status-message" id="statusMessage">Ready</div>
        </div>
      </div>

      <!-- Main Content Grid -->
      <div class="main-content">
        <!-- Services Section -->
        <div class="services-section">
      <!-- Streaming Services -->
          <div>
      <div class="section-title">üì∫ Streaming Services</div>
      <div class="button-grid">
              <button class="dashboard-button" onclick="launchService('netflix')" data-service="netflix">
                <img src="https://cdn.worldvectorlogo.com/logos/netflix-3.svg" class="service-logo" alt="Netflix" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span class="button-icon" style="display:none;">üé¨</span>
          <span class="button-label">Netflix</span>
        </button>
              <button class="dashboard-button" onclick="launchService('amazon')" data-service="amazon">
                <img src="https://cdn.worldvectorlogo.com/logos/amazon-prime-video-1.svg" class="service-logo" alt="Amazon Prime" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span class="button-icon" style="display:none;">üéûÔ∏è</span>
          <span class="button-label">Amazon Prime</span>
        </button>
              <button class="dashboard-button" onclick="launchService('youtube')" data-service="youtube">
                <img src="https://cdn.worldvectorlogo.com/logos/youtube-icon-2.svg" class="service-logo" alt="YouTube" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span class="button-icon" style="display:none;">‚ñ∂Ô∏è</span>
          <span class="button-label">YouTube</span>
        </button>
              <button class="dashboard-button" onclick="launchService('plex')" data-service="plex">
                <img src="plex film.jpg" class="service-logo" alt="Plex" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span class="button-icon" style="display:none;">üì∫</span>
          <span class="button-label">Plex</span>
        </button>
              <button class="dashboard-button" onclick="launchService('livetv')" data-service="livetv">
          <img src="tvip.jpg" class="service-logo" alt="Live TV" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
          <span class="button-icon" style="display:none;">üì°</span>
          <span class="button-label">Live TV</span>
        </button>
              <button class="dashboard-button" onclick="launchService('plexamp')" data-service="plexamp">
                <img src="plex music.jpg" class="service-logo" alt="Plexamp" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span class="button-icon" style="display:none;">üéµ</span>
          <span class="button-label">Plexamp</span>
        </button>
              <button class="dashboard-button" onclick="launchService('spotify')" data-service="spotify">
                <img src="https://open.spotify.com/favicon.ico" class="service-logo" alt="Spotify" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span class="button-icon" style="display:none;">üéß</span>
          <span class="button-label">Spotify</span>
        </button>
              <button class="dashboard-button" onclick="launchService('smarthome')" data-service="smarthome">
                <img src="https://cdn.worldvectorlogo.com/logos/home-assistant.svg" class="service-logo" alt="Home Assistant" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span class="button-icon" style="display:none;">üè†</span>
          <span class="button-label">Smart Home</span>
        </button>
              <button class="dashboard-button" onclick="launchService('news')" data-service="news">
                <img src="https://cdn.worldvectorlogo.com/logos/bbc-logo.svg" class="service-logo" alt="BBC News" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span class="button-icon" style="display:none;">üì∞</span>
                <span class="button-label">News</span>
              </button>
              <button class="dashboard-button" onclick="launchService('telegram')" data-service="telegram">
                <img src="https://cdn.worldvectorlogo.com/logos/telegram-1.svg" class="service-logo" alt="Telegram" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span class="button-icon" style="display:none;">üí¨</span>
                <span class="button-label">Telegram</span>
              </button>
              <button class="dashboard-button" onclick="launchService('calendar')" data-service="calendar">
                <img src="https://cdn.worldvectorlogo.com/logos/microsoft-outlook-2019.svg" class="service-logo" alt="Calendar" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span class="button-icon" style="display:none;">üìÖ</span>
                <span class="button-label">Calendar</span>
        </button>
      </div>
          </div>
          </div>
          
        <!-- Controls Section -->
        <div class="controls-row">
          <!-- Volume & Lighting Controls -->
          <div class="volume-lighting-section">
            <div class="section-title">üîä Volume & Lighting</div>
            
            <!-- Volume Control -->
            <div class="audio-section">
          <div class="volume-control">
            <button class="volume-btn" onclick="adjustVolume(-5)">-</button>
            <span class="volume-icon">üîà</span>
            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50" oninput="setVolume(this.value)">
            <span class="volume-icon">üîä</span>
            <button class="volume-btn" onclick="adjustVolume(5)">+</button>
            <span id="volumeValue">50%</span>
          </div>
        </div>
            
            <!-- Lighting Controls -->
            <div class="section-title" style="margin-top: 20px;">üí° Room Lights</div>
            <div class="lighting-controls">
              <div class="volume-control">
                <button class="volume-btn" onclick="adjustLightBrightness(-10)">-</button>
                <span class="volume-icon">üîÖ</span>
                <input type="range" class="volume-slider" id="lightSlider" min="0" max="100" value="50" oninput="setLightBrightness(this.value)">
                <span class="volume-icon">üîÜ</span>
                <button class="volume-btn" onclick="adjustLightBrightness(10)">+</button>
                <span id="lightValue">50%</span>
              </div>
            </div>
      </div>

          <!-- System Controls (Collapsible) -->
          <div class="system-section">
            <div class="collapsible-header" onclick="toggleSystemCollapse()">
              <div class="section-title" style="margin: 0;">‚öôÔ∏è System</div>
              <span class="collapse-icon" id="systemCollapseIcon">‚ñº</span>
            </div>
            <div class="collapsible-content" id="systemContent">
              <!-- Mode Controls -->
              <div class="section-title" style="margin-top: 15px; margin-bottom: 10px;">üñ•Ô∏è Launch Mode</div>
              <div class="mode-controls">
                <div class="mode-toggle" onclick="toggleLaunchMode()">
                  <span id="modeLabel">üñ•Ô∏è Container Mode</span>
                  <div class="toggle-switch" id="modeSwitch">
                    <div class="toggle-slider"></div>
                  </div>
                </div>
                <div class="mode-toggle" onclick="toggleHassAutoLogin()">
                  <span id="hassAutoLoginLabel">üîê HA Manual Login</span>
                  <div class="toggle-switch" id="hassAutoLoginSwitch">
                    <div class="toggle-slider"></div>
                  </div>
                </div>
              </div>
              
              <!-- Audio Output Selection -->
              <div class="section-title" style="margin-top: 15px; margin-bottom: 10px;">üîä Audio Output</div>
              <div class="audio-output-selector" id="audioOutputs">
                <button class="audio-btn" onclick="switchAudio('hdmi')">HDMI</button>
                <button class="audio-btn" onclick="switchAudio('spdif')">SPDIF</button>
                <button class="audio-btn" onclick="switchAudio('analog')">Analog</button>
              </div>
              
              <!-- System Actions -->
              <div class="section-title" style="margin-top: 20px; margin-bottom: 10px;">‚öôÔ∏è System Actions</div>
      <div class="system-controls">
        <button class="system-btn" onclick="refreshAudioDevices()">üîÑ Refresh Audio</button>
        <button class="system-btn" onclick="systemAction('shutdown')">üîå Shutdown</button>
        <button class="system-btn" onclick="systemAction('restart')">üîÉ Restart</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Info Bar with Time, Weather, and System Info -->
      <div class="info-bar">
        <div class="info-item">
          <div class="info-icon">üïê</div>
          <div class="info-main" id="currentTime">--:--</div>
          <div class="info-sub" id="currentDate">Loading...</div>
      </div>

        <div class="info-item">
          <div class="info-icon" id="weatherIcon">üå§Ô∏è</div>
          <div class="info-main" id="temperature">--¬∞</div>
          <div class="info-sub" id="weatherDesc">Loading weather...</div>
        </div>
        
        <div class="info-item">
          <div class="info-icon">üåê</div>
          <div class="info-main" id="ipAddress">Checking...</div>
          <div class="info-sub">IP Address</div>
        </div>
        
        <div class="info-item">
          <div class="info-icon">üíæ</div>
          <div class="info-main" id="systemLoad">--</div>
          <div class="info-sub">CPU Usage</div>
        </div>
      </div>

      <!-- News Ticker -->
      <div class="news-ticker">
        <div class="news-content" id="newsContent">
          <span class="news-item">üåê Breaking: Latest tech updates and streaming news</span>
          <span class="news-item">üì∫ New shows and movies now available on your favorite platforms</span>
          <span class="news-item">üîä MediaBox AI now supports enhanced audio controls and smart home integration</span>
          <span class="news-item">‚ö° System performance optimizations and new features rolling out</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = '/api';  // Use relative path since Flask serves both
    let currentVolume = 50;
    let currentLightLevel = 50;
    let browserMode = false; // false = Container Mode, true = Browser Mode
    let hassAutoLogin = false; // false = Manual Login, true = Auto-Login
    let hassCredentials = { username: '', password: '' };

    // Service URL mappings
    // Using window.location.hostname for smarthome so it works from any device on the network
    const SERVICE_URLS = {
      netflix: 'https://www.netflix.com',
      plex: 'http://netlite.community:32400/web/index.html',
      plexamp: 'https://plexamp.com/web?server=netlite.community:32400',  // Plexamp web interface with server
      amazon: 'https://www.primevideo.com/collection/IncludedwithPrime',
      youtube: 'https://www.youtube.com',
      spotify: 'https://open.spotify.com',
      smarthome: 'http://' + window.location.hostname + ':8123',
      livetv: 'http://' + window.location.hostname + ':8080/iptv',
      news: 'https://www.bbc.com/news',  // BBC News - clean, TV-friendly layout
      telegram: 'https://web.telegram.org',
      calendar: 'https://outlook.office.com/bookings/calendar'  // Outlook Bookings Calendar
    };

    // Fetch Home Assistant credentials
    async function fetchHassCredentials() {
      try {
        const response = await fetch(`${API_BASE}/hass-config`);
        const data = await response.json();
        if (data.success) {
          hassCredentials.username = data.username;
          hassCredentials.password = data.password;
        }
      } catch (err) {
        console.error('Failed to fetch HA credentials:', err);
      }
    }

    // Toggle Home Assistant Auto-Login
    function toggleHassAutoLogin() {
      hassAutoLogin = !hassAutoLogin;
      const hassSwitch = document.getElementById('hassAutoLoginSwitch');
      const hassLabel = document.getElementById('hassAutoLoginLabel');
      
      if (hassAutoLogin) {
        hassSwitch.classList.add('active');
        hassLabel.textContent = 'üîì HA Auto-Login';
        showStatus('Home Assistant Auto-Login enabled', 'success');
      } else {
        hassSwitch.classList.remove('active');
        hassLabel.textContent = 'üîê HA Manual Login';
        showStatus('Home Assistant Auto-Login disabled', 'success');
      }
      
      // Save preference to localStorage
      localStorage.setItem('hassAutoLogin', hassAutoLogin ? 'enabled' : 'disabled');
    }

    // Open Home Assistant with auto-login
    function openHomeAssistantWithLogin() {
      const hassUrl = 'http://' + window.location.hostname + ':8123';
      
      // For now, just open Home Assistant normally
      // Note: Auto-login requires Home Assistant long-lived access token
      // which should be configured in the Home Assistant UI and stored as a cookie
      showStatus('Tip: Use Home Assistant "Remember me" checkbox for auto-login', 'info');
      window.open(hassUrl, '_blank');
    }

    // Toggle between Container Mode and Browser Mode
    function toggleLaunchMode() {
      browserMode = !browserMode;
      const modeSwitch = document.getElementById('modeSwitch');
      const modeLabel = document.getElementById('modeLabel');
      
      if (browserMode) {
        modeSwitch.classList.add('active');
        modeLabel.textContent = 'üåê Browser Mode';
        showStatus('Switched to Browser Mode - Services will open in Windows browser', 'success');
      } else {
        modeSwitch.classList.remove('active');
        modeLabel.textContent = 'üñ•Ô∏è Container Mode';
        showStatus('Switched to Container Mode - Services will launch in Docker', 'success');
      }
      
      // Save preference to localStorage
      localStorage.setItem('launchMode', browserMode ? 'browser' : 'container');
    }

    // Launch streaming service
    function launchService(service) {
      // Highlight the clicked button with yellow border animation
      document.querySelectorAll('.dashboard-button').forEach(btn => {
        btn.classList.remove('clicked');
      });
      const clickedButton = document.querySelector('[data-service="' + service + '"]');
      if (clickedButton) {
        clickedButton.classList.add('clicked');
        // Remove the class after animation completes
        setTimeout(() => {
          clickedButton.classList.remove('clicked');
        }, 2000);
      }
      
      // Wait 2 seconds to let the yellow box highlighter animation run
      setTimeout(() => {
        if (browserMode) {
        // Browser Mode: Open directly in Windows browser
        
        // Special handling for Plexamp - launch via API even in browser mode
        if (service === 'plexamp') {
          showStatus('Launching Plexamp native application...', 'info');
          // Launch via API even in browser mode for Plexamp
          fetch(`${API_BASE}/launch/${service}`, {
            method: 'POST'
          })
          .then(response => response.json())
          .then(data => {
            showStatus(data.message || 'Plexamp launched successfully', 'success');
            // Show additional info about VNC access
            setTimeout(() => {
              showStatus('Plexamp is running in the container. Use VNC viewer to connect to localhost:5900 to view it', 'info');
            }, 2000);
          })
          .catch(err => {
            showStatus(`Failed to launch Plexamp: ${err.message}`, 'error');
            console.error(err);
          });
          return;
        }
        
        // Special handling for Live TV - launch via API even in browser mode
        if (service === 'livetv') {
          showStatus('Launching Live TV (IPTV) with VLC...', 'info');
          // Launch via API even in browser mode for IPTV
          fetch(`${API_BASE}/launch/${service}`, {
            method: 'POST'
          })
          .then(response => response.json())
          .then(data => {
            showStatus(data.message || 'Live TV (IPTV) launched successfully', 'success');
            // Show additional info about VNC access
            setTimeout(() => {
              showStatus('VLC is running in the container. Use VNC viewer to connect to localhost:5900 to view it', 'info');
            }, 2000);
          })
          .catch(err => {
            showStatus(`Failed to launch Live TV (IPTV): ${err.message}`, 'error');
            console.error(err);
          });
          return;
        }
        
        // Special handling for Home Assistant with auto-login
        if (service === 'smarthome' && hassAutoLogin) {
          showStatus('Opening Home Assistant with auto-login...', 'info');
          openHomeAssistantWithLogin();
          setTimeout(() => {
            showStatus('Home Assistant opened', 'success');
          }, 500);
          return;
        }
        
        const url = SERVICE_URLS[service];
        if (url) {
          showStatus(`Opening ${service} in browser...`, 'info');
          window.open(url, '_blank');
          setTimeout(() => {
            showStatus(`${service} opened in new tab`, 'success');
          }, 500);
        } else {
          showStatus(`Unknown service: ${service}`, 'error');
        }
      } else {
        // Container Mode: Launch via API in Docker container
        
        // Special handling for Plexamp with better feedback
        if (service === 'plexamp') {
          showStatus('Launching Plexamp native application...', 'info');
        }
        // Special handling for Live TV with better feedback
        else if (service === 'livetv') {
          showStatus('Launching Live TV (IPTV) with VLC...', 'info');
        } else {
          showStatus(`Launching ${service} in container...`, 'info');
        }
        
      fetch(`${API_BASE}/launch/${service}`, {
        method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
        if (service === 'plexamp') {
          showStatus(data.message || 'Plexamp launched successfully', 'success');
          // Show additional info about VNC access
          setTimeout(() => {
            showStatus('Plexamp is running in the container. Use VNC viewer to connect to localhost:5900 to view it', 'info');
          }, 2000);
        } else if (service === 'livetv') {
          showStatus(data.message || 'Live TV (IPTV) launched successfully', 'success');
          // Show additional info about VNC access
          setTimeout(() => {
            showStatus('VLC is running in the container. Use VNC viewer to connect to localhost:5900 to view it', 'info');
          }, 2000);
        } else {
          showStatus(data.message || `${service} launched successfully`, 'success');
        }
      })
      .catch(err => {
        if (service === 'plexamp') {
          showStatus(`Failed to launch Plexamp: ${err.message}`, 'error');
        } else if (service === 'livetv') {
          showStatus(`Failed to launch Live TV (IPTV): ${err.message}`, 'error');
        } else {
          showStatus(`Failed to launch ${service}: ${err.message}`, 'error');
        }
        console.error(err);
      });
      }
      }, 2000); // End of 2-second delay
    }

    // Switch audio output
    function switchAudio(output) {
      showStatus(`Switching to ${output}...`, 'info');
      fetch(`${API_BASE}/switch-audio`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ output: output })
      })
      .then(response => response.json())
      .then(data => {
        showStatus(data.message || `Switched to ${output}`, 'success');
        highlightActiveAudio(output);
      })
      .catch(err => {
        showStatus(`Failed to switch audio: ${err.message}`, 'error');
        console.error(err);
      });
    }

    // Set volume
    function setVolume(value) {
      currentVolume = value;
      document.getElementById('volumeValue').textContent = value + '%';
      
      // Debounce the API call
      clearTimeout(window.volumeTimeout);
      window.volumeTimeout = setTimeout(() => {
        fetch(`${API_BASE}/volume`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ volume: parseInt(value) })
        })
        .then(response => response.json())
        .then(data => {
          showStatus(data.message || `Volume set to ${value}%`, 'success');
        })
        .catch(err => {
          showStatus(`Failed to set volume: ${err.message}`, 'error');
          console.error(err);
        });
      }, 300);
    }

    // Adjust volume by increment/decrement
    function adjustVolume(change) {
      const newVolume = Math.max(0, Math.min(100, currentVolume + change));
      document.getElementById('volumeSlider').value = newVolume;
      setVolume(newVolume);
    }

    // Set light brightness
    function setLightBrightness(value) {
      currentLightLevel = value;
      document.getElementById('lightValue').textContent = value + '%';
      
      // Debounce the API call
      clearTimeout(window.lightTimeout);
      window.lightTimeout = setTimeout(() => {
        fetch(`${API_BASE}/lighting/brightness`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ brightness: parseInt(value) })
        })
        .then(response => response.json())
        .then(data => {
          showStatus(data.message || `Brightness set to ${value}%`, 'success');
        })
        .catch(err => {
          showStatus(`Failed to set brightness: ${err.message}`, 'error');
          console.error(err);
        });
      }, 300);
    }

    // Adjust light brightness by increment/decrement
    function adjustLightBrightness(change) {
      const newBrightness = Math.max(0, Math.min(100, currentLightLevel + change));
      document.getElementById('lightSlider').value = newBrightness;
      setLightBrightness(newBrightness);
    }

    // System actions
    function systemAction(action) {
      if (action === 'shutdown' || action === 'restart') {
        if (!confirm(`Are you sure you want to ${action} the system?`)) {
          return;
        }
      }
      
      showStatus(`Executing ${action}...`, 'info');
      fetch(`${API_BASE}/${action}`, {
        method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
        showStatus(data.message || `${action} executed`, 'success');
      })
      .catch(err => {
        showStatus(`Failed to ${action}: ${err.message}`, 'error');
        console.error(err);
      });
    }

    // Refresh audio devices
    function refreshAudioDevices() {
      showStatus('Refreshing audio devices...', 'info');
      fetch(`${API_BASE}/audio-devices`)
      .then(response => response.json())
      .then(data => {
        showStatus(`Found ${data.devices?.length || 0} audio devices`, 'success');
        updateAudioDevices(data.devices);
      })
      .catch(err => {
        showStatus(`Failed to refresh audio devices: ${err.message}`, 'error');
        console.error(err);
      });
    }

    // Update audio device buttons
    function updateAudioDevices(devices) {
      if (!devices || devices.length === 0) return;
      
      const container = document.getElementById('audioOutputs');
      container.innerHTML = '';
      
      devices.forEach(device => {
        const btn = document.createElement('button');
        btn.className = 'audio-btn';
        if (device.active) {
          btn.classList.add('active');
        }
        btn.textContent = device.name;
        btn.onclick = () => switchAudio(device.id);
        container.appendChild(btn);
      });
    }

    // Highlight active audio output
    function highlightActiveAudio(output) {
      document.querySelectorAll('.audio-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.toLowerCase().includes(output.toLowerCase())) {
          btn.classList.add('active');
        }
      });
    }

    // Show status message
    function showStatus(message, type = 'info') {
      const statusEl = document.getElementById('statusMessage');
      statusEl.textContent = message;
      
      // Clear previous color classes
      statusEl.style.background = type === 'error' 
        ? 'rgba(255, 100, 100, 0.3)' 
        : type === 'success'
        ? 'rgba(100, 255, 100, 0.3)'
        : 'rgba(0, 0, 0, 0.2)';
      
      // Auto-clear after 5 seconds
      setTimeout(() => {
        if (statusEl.textContent === message) {
          statusEl.textContent = 'Ready';
          statusEl.style.background = 'rgba(0, 0, 0, 0.2)';
        }
      }, 5000);
    }

    // Lighting control
    function adjustLighting(action) {
      showStatus(`${action === 'dim' ? 'Dimming' : 'Brightening'} lights...`, 'info');
      fetch(`${API_BASE}/lighting/${action}`, {
        method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
        showStatus(data.message || `Lights ${action === 'dim' ? 'dimmed' : 'brightened'}`, 'success');
      })
      .catch(err => {
        showStatus(`Failed to adjust lighting: ${err.message}`, 'error');
        console.error(err);
      });
    }

    // Update clock
    function updateClock() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit',
        hour12: true 
      });
      const dateStr = now.toLocaleDateString('en-US', { 
        weekday: 'long', 
        month: 'short', 
        day: 'numeric' 
      });
      
      document.getElementById('currentTime').textContent = timeStr;
      document.getElementById('currentDate').textContent = dateStr;
    }

    // Fetch weather data
    async function fetchWeather() {
      try {
        // Using wttr.in for simple weather API (no key needed)
        const response = await fetch('https://wttr.in/?format=j1');
        const data = await response.json();
        
        const temp = Math.round((parseInt(data.current_condition[0].temp_F)));
        const desc = data.current_condition[0].weatherDesc[0].value;
        const weatherCode = data.current_condition[0].weatherCode;
        
        // Weather icons based on code
        const weatherIcons = {
          113: '‚òÄÔ∏è',  // Sunny
          116: '‚õÖ',  // Partly cloudy
          119: '‚òÅÔ∏è',  // Cloudy
          122: '‚òÅÔ∏è',  // Overcast
          143: 'üå´Ô∏è',  // Mist
          176: 'üå¶Ô∏è',  // Patchy rain possible
          179: 'üå®Ô∏è',  // Patchy snow possible
          200: '‚õàÔ∏è',  // Thundery outbreaks possible
          263: 'üåßÔ∏è',  // Patchy light drizzle
          266: 'üåßÔ∏è',  // Light drizzle
          281: 'üåßÔ∏è',  // Freezing drizzle
          284: 'üåßÔ∏è',  // Heavy freezing drizzle
          293: 'üåßÔ∏è',  // Patchy light rain
          296: 'üåßÔ∏è',  // Light rain
          299: 'üåßÔ∏è',  // Moderate rain
          302: 'üåßÔ∏è',  // Moderate rain
          305: 'üåßÔ∏è',  // Heavy rain
          308: 'üåßÔ∏è',  // Heavy rain
          311: 'üåßÔ∏è',  // Light freezing rain
          314: 'üåßÔ∏è',  // Moderate or heavy freezing rain
          317: 'üå®Ô∏è',  // Light sleet
          320: 'üå®Ô∏è',  // Moderate or heavy sleet
          323: 'üå®Ô∏è',  // Patchy light snow
          326: '‚ùÑÔ∏è',  // Light snow
          329: '‚ùÑÔ∏è',  // Patchy moderate snow
          332: '‚ùÑÔ∏è',  // Moderate snow
          335: '‚ùÑÔ∏è',  // Patchy heavy snow
          338: '‚ùÑÔ∏è',  // Heavy snow
          350: 'üå®Ô∏è',  // Ice pellets
          353: 'üåßÔ∏è',  // Light rain shower
          356: 'üåßÔ∏è',  // Moderate or heavy rain shower
          359: 'üåßÔ∏è',  // Torrential rain shower
          362: 'üå®Ô∏è',  // Light sleet showers
          365: 'üå®Ô∏è',  // Moderate or heavy sleet showers
          368: 'üå®Ô∏è',  // Light snow showers
          371: '‚ùÑÔ∏è',  // Moderate or heavy snow showers
          374: 'üå®Ô∏è',  // Light showers of ice pellets
          377: 'üå®Ô∏è',  // Moderate or heavy showers of ice pellets
          386: '‚õàÔ∏è',  // Patchy light rain with thunder
          389: '‚õàÔ∏è',  // Moderate or heavy rain with thunder
          392: '‚õàÔ∏è',  // Patchy light snow with thunder
          395: '‚õàÔ∏è',  // Moderate or heavy snow with thunder
        };
        
        document.getElementById('weatherIcon').textContent = weatherIcons[weatherCode] || 'üå§Ô∏è';
        document.getElementById('temperature').textContent = `${temp}¬∞F`;
        document.getElementById('weatherDesc').textContent = desc;
      } catch (err) {
        console.error('Weather fetch error:', err);
        document.getElementById('weatherDesc').textContent = 'Weather unavailable';
      }
    }

    // Fetch network status
    async function fetchNetworkStatus() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        document.getElementById('ipAddress').textContent = data.ip;
      } catch (err) {
        document.getElementById('ipAddress').textContent = 'Offline';
        console.error('Network status error:', err);
      }
    }

    // Fetch system load
    async function fetchSystemLoad() {
      try {
        const response = await fetch(`${API_BASE}/status`);
        const data = await response.json();
        if (data.success && data.status) {
          const cpuLoad = data.status.cpu_percent || 0;
          document.getElementById('systemLoad').textContent = `${cpuLoad}%`;
        }
      } catch (err) {
        console.error('System load fetch error:', err);
        document.getElementById('systemLoad').textContent = '--';
      }
    }

    // Fetch version and build information
    async function fetchVersionInfo() {
      try {
        const response = await fetch(`${API_BASE}/version`);
        const data = await response.json();
        if (data.success) {
          document.getElementById('versionNumber').textContent = data.version;
          document.getElementById('buildNumber').textContent = `Build ${data.build}`;
        }
      } catch (err) {
        console.error('Version fetch error:', err);
        document.getElementById('versionNumber').textContent = 'Unknown';
        document.getElementById('buildNumber').textContent = 'Build Unknown';
      }
    }

    // News ticker functionality
    let newsMode = 'internal'; // 'internal' or 'external'
    let bbcNewsData = [];
    let currentNewsIndex = 0;

    // Internal MediaBox AI news items
    const internalNews = [
      "üåê Breaking: Latest tech updates and streaming news",
      "üì∫ New shows and movies now available on your favorite platforms", 
      "üîä MediaBox AI now supports enhanced audio controls and smart home integration",
      "‚ö° System performance optimizations and new features rolling out",
      "üè† Smart home integration now supports more devices and automations",
      "üé¨ Enhanced streaming quality and faster loading times implemented",
      "üîß New system monitoring tools and health checks available",
      "üì± Improved mobile and tablet compatibility for remote access"
    ];

    // Fetch BBC news headlines
    async function fetchBBCNews() {
      try {
        // Using a CORS proxy to fetch BBC news (since BBC doesn't allow direct CORS)
        const response = await fetch(`${API_BASE}/bbc-news`);
        const data = await response.json();
        
        if (data.success && data.headlines) {
          bbcNewsData = data.headlines.map(headline => `üì∞ ${headline}`);
          console.log('BBC news loaded:', bbcNewsData.length, 'headlines');
        }
      } catch (err) {
        console.error('Failed to fetch BBC news:', err);
        // Fallback to internal news if BBC fails
        bbcNewsData = [];
      }
    }

    // Update news ticker content
    function updateNewsTicker() {
      const newsContent = document.getElementById('newsContent');
      if (!newsContent) return;

      let newsItems = [];
      
      if (newsMode === 'internal') {
        newsItems = internalNews;
      } else if (newsMode === 'external' && bbcNewsData.length > 0) {
        newsItems = bbcNewsData;
      } else {
        newsItems = internalNews; // Fallback
      }

      // Create news items HTML
      const newsHTML = newsItems.map(item => 
        `<span class="news-item">${item}</span>`
      ).join('');
      
      newsContent.innerHTML = newsHTML;
    }

    // Switch between internal and external news
    function switchNewsMode() {
      if (newsMode === 'internal') {
        newsMode = 'external';
        console.log('Switching to BBC news');
      } else {
        newsMode = 'internal';
        console.log('Switching to internal news');
      }
      updateNewsTicker();
    }

    // Initialize news ticker
    function initializeNewsTicker() {
      // Wait 1.5 seconds before showing content to allow button highlighting animations
      setTimeout(() => {
        // Start with internal news
        newsMode = 'internal';
        updateNewsTicker();
        
        // Fetch BBC news in background
        fetchBBCNews();
        
        // Switch to BBC news after 20 seconds (from now, not from page load)
        setTimeout(() => {
          if (bbcNewsData.length > 0) {
            switchNewsMode();
          }
        }, 20000);
        
        // Refresh BBC news every 10 minutes
        setInterval(fetchBBCNews, 600000);
      }, 1500);
    }

    // Initialize and start updates
    function initializeInfoBar() {
      // Update clock immediately and every second
      updateClock();
      setInterval(updateClock, 1000);
      
      // Fetch weather and network info
      fetchWeather();
      fetchNetworkStatus();
      fetchSystemLoad();
      fetchVersionInfo();
      
      // Initialize news ticker
      initializeNewsTicker();
      
      // Update weather every 10 minutes
      setInterval(fetchWeather, 600000);
      
      // Update network status every 5 minutes
      setInterval(fetchNetworkStatus, 300000);
      
      // Update system load every 30 seconds
      setInterval(fetchSystemLoad, 30000);
    }

    // Restore saved preferences
    function restoreLaunchMode() {
      // Restore launch mode preference
      const savedMode = localStorage.getItem('launchMode');
      if (savedMode === 'browser') {
        browserMode = true;
        document.getElementById('modeSwitch').classList.add('active');
        document.getElementById('modeLabel').textContent = 'üåê Browser Mode';
      }
      
      // Restore Home Assistant auto-login preference
      const savedHassLogin = localStorage.getItem('hassAutoLogin');
      if (savedHassLogin === 'enabled') {
        hassAutoLogin = true;
        document.getElementById('hassAutoLoginSwitch').classList.add('active');
        document.getElementById('hassAutoLoginLabel').textContent = 'üîì HA Auto-Login';
      }
    }

    // Toggle system section collapse
    function toggleSystemCollapse() {
      const content = document.getElementById('systemContent');
      const icon = document.getElementById('systemCollapseIcon');
      
      content.classList.toggle('expanded');
      icon.classList.toggle('expanded');
    }

    // Help modal controls
    function toggleHelp() {
      const modal = document.getElementById('helpModal');
      modal.classList.toggle('active');
      
      // Prevent body scroll when modal is open
      if (modal.classList.contains('active')) {
        document.body.style.overflow = 'hidden';
      } else {
        document.body.style.overflow = 'auto';
      }
    }

    function closeHelpOnBackground(event) {
      if (event.target.id === 'helpModal') {
        toggleHelp();
      }
    }

    // Close help modal with ESC key
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        const modal = document.getElementById('helpModal');
        if (modal.classList.contains('active')) {
          toggleHelp();
        }
      }
    });

    // Load initial data on page load
    window.addEventListener('load', () => {
      restoreLaunchMode();
      fetchHassCredentials();
      refreshAudioDevices();
      initializeInfoBar();
    });
  </script>
</body>
</html>
